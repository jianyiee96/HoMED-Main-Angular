<div class="ui-g">
    <div class="ui-g-12 ui-lg-6">
        <div class="card">
            <h1>My Form Instances</h1>
            <!-- <div *ngFor="let formInstance of formInstances">
                <div class="card">
                    <h2>{{formInstance.formTemplateMapping.formTemplateName}}</h2>

                    <button pButton icon="ui-icon-add" label="View details" (click)="select(formInstance)"></button>
                </div>
            </div> -->
            <p-table #dt [value]="formInstances" selectionMode="single" [(selection)]="selectedFormInstance"
                dataKey="formInstanceId" (onRowSelect)="onRowSelect($event)" (onRowUnselect)="onRowUnselect($event)">
                <ng-template pTemplate="header">
                    <tr>
                        <!-- <th pSortableColumn="formInstanceId">Form Instance Id <p-sortIcon field="formInstanceId"></p-sortIcon></th> -->
                        <th pSortableColumn="templateName">Form Template Name <p-sortIcon field="templateName"></p-sortIcon></th>
                        <th pSortableColumn="dateCreated">Form Instance Date Created <p-sortIcon field="dateCreated"></p-sortIcon></th>
                        <th pSortableColumn="status">Form Instance Status <p-sortIcon field="status"></p-sortIcon></th>
                        <th pSortableColumn="dateSubmitted">Date Submitted <p-sortIcon field="status"></p-sortIcon></th>
                        <th style="width:4rem"></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-formInstance>
                    <tr [pSelectableRow]="formInstance" *ngIf="formInstance.formInstanceStatusEnum !== 'ARCHIVED'">
                        <!-- <td>{{formInstance.formInstanceId}}</td> -->
                        <td>{{formInstance.formTemplateMapping.formTemplateName}}</td>
                        <td>{{ formInstance.dateCreated | date:'medium' }}</td>
                        <td>{{formInstance.formInstanceStatusEnum}}</td>
                        <td *ngIf="formInstance.dateSubmitted !== undefined">{{ formInstance.dateSubmitted | date:'medium'}}</td>
                        <td *ngIf="formInstance.dateSubmitted === undefined">N.A</td>
                        <td>
                            <button pButton pRipple type="button" icon="ui-icon-archive"
                                title="Archive"
                                [disabled]="formInstance.formInstanceStatusEnum !== 'SUBMITTED'"
                                (click)="archive(formInstance)" class="p-button-rounded p-button-outlined">
                            </button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
            <button pButton icon="ui-icon-add" label="Add new Form Instance" routerLink="/form-repo-screen"></button>

        </div>
        <p-toast key="tst" position="bottom-center"></p-toast>
    </div>
    <div class="ui-g-12 ui-lg-6" *ngIf="selected">
        <form #viewFormInstanceDetailsForm="ngForm" (ngSubmit)="submit(viewFormInstanceDetailsForm)">
            <div class="card" style="text-align: left;">
                <p-messages [closable]="false" [value]="msgForDialog"></p-messages>
                <div id="content" class="ui-fluid">
                    <h1>{{selectedFormInstance.formTemplateMapping.formTemplateName}}</h1>

                    <div *ngFor="let formInstanceField of this.selectedFormInstance.formInstanceFields">

                        <div *ngIf="formInstanceField.formFieldMapping.inputType === 'HEADER'">
                            <h4 class="headerInput">{{formInstanceField.formFieldMapping.question}}</h4>
                        </div>
                        <div class="card" *ngIf="formInstanceField.formFieldMapping.inputType != 'HEADER'">
                            <div *ngIf="formInstanceField.formFieldMapping.inputType === 'TEXT'">
                                <h4 class="ui-g">{{formInstanceField.formFieldMapping.question}} <div
                                        class="isRequiredSymbol" *ngIf="formInstanceField.formFieldMapping.isRequired">*
                                    </div>
                                    <p-message class="doctorOnlyMsg"
                                        *ngIf="!formInstanceField.formFieldMapping.isServicemanEditable" severity="warn"
                                        text="Doctor editable only"></p-message>
                                </h4>
                                <input type="text" pInputText name="textInput" placeholder="Text"
                                    [readonly]="!formInstanceField.formFieldMapping.isServicemanEditable"
                                    [(ngModel)]="selectedFieldValues[formInstanceField.formInstanceFieldId]" />
                            </div>

                            <div *ngIf="formInstanceField.formFieldMapping.inputType === 'NUMBER'">
                                <h4 class="ui-g">{{formInstanceField.formFieldMapping.question}} <div
                                        class="isRequiredSymbol" *ngIf="formInstanceField.formFieldMapping.isRequired">*
                                    </div>
                                    <p-message class="doctorOnlyMsg"
                                        *ngIf="!formInstanceField.formFieldMapping.isServicemanEditable" severity="warn"
                                        text="Doctor editable only"></p-message>
                                </h4>
                                <input type="number" pInputText name="numberInput" required
                                    [readonly]="!formInstanceField.formFieldMapping.isServicemanEditable"
                                    [(ngModel)]="selectedFieldValues[formInstanceField.formInstanceFieldId]" />

                            </div>

                            <div *ngIf="formInstanceField.formFieldMapping.inputType === 'CHECK_BOX'">
                                <h4 class="ui-g">{{formInstanceField.formFieldMapping.question}} <div
                                        class="isRequiredSymbol" *ngIf="formInstanceField.formFieldMapping.isRequired">*
                                    </div>
                                    <p-message class="doctorOnlyMsg"
                                        *ngIf="!formInstanceField.formFieldMapping.isServicemanEditable" severity="warn"
                                        text="Doctor editable only"></p-message>
                                </h4>
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-4"
                                        *ngFor="let formFieldOption of formInstanceField.formFieldMapping.formFieldOptions">
                                        <p-checkbox name="checkboxInput"
                                            value="{{formFieldOption.formFieldOptionValue}}"
                                            [(ngModel)]="selectedFieldValues[formInstanceField.formInstanceFieldId]"
                                            label="{{formFieldOption.formFieldOptionValue}}"></p-checkbox>
                                    </div>
                                </div>
                            </div>

                            <div *ngIf="formInstanceField.formFieldMapping.inputType === 'MULTI_DROPDOWN'">
                                <h4 class="ui-g">{{formInstanceField.formFieldMapping.question}} <div
                                        class="isRequiredSymbol" *ngIf="formInstanceField.formFieldMapping.isRequired">*
                                    </div>
                                    <p-message class="doctorOnlyMsg"
                                        *ngIf="!formInstanceField.formFieldMapping.isServicemanEditable" severity="warn"
                                        text="Doctor editable only"></p-message>
                                </h4>
                                <p-multiSelect name="multiSelectInput"
                                    [options]="formInstanceField.formFieldMapping.formFieldOptions"
                                    dataKey="formFieldOptionValue"
                                    [(ngModel)]="selectedFieldValues[formInstanceField.formInstanceFieldId]"
                                    optionLabel="formFieldOptionValue"></p-multiSelect>

                            </div>
                            <div *ngIf="formInstanceField.formFieldMapping.inputType === 'SINGLE_DROPDOWN'">
                                <h4 class="ui-g">{{formInstanceField.formFieldMapping.question}} <div
                                        class="isRequiredSymbol" *ngIf="formInstanceField.formFieldMapping.isRequired">*
                                    </div>
                                    <p-message class="doctorOnlyMsg"
                                        *ngIf="!formInstanceField.formFieldMapping.isServicemanEditable" severity="warn"
                                        text="Doctor editable only"></p-message>
                                </h4>
                                <p-dropdown name="singleSelectInput"
                                    [options]="formInstanceField.formFieldMapping.formFieldOptions"
                                    dataKey="formFieldOptionValue"
                                    [(ngModel)]="selectedFieldValues[formInstanceField.formInstanceFieldId]"
                                    optionLabel="formFieldOptionValue"></p-dropdown>


                            </div>
                            <div *ngIf="formInstanceField.formFieldMapping.inputType === 'RADIO_BUTTON'">
                                <h4 class="ui-g">{{formInstanceField.formFieldMapping.question}} <div
                                        class="isRequiredSymbol" *ngIf="formInstanceField.formFieldMapping.isRequired">*
                                    </div>
                                    <p-message class="doctorOnlyMsg"
                                        *ngIf="!formInstanceField.formFieldMapping.isServicemanEditable" severity="warn"
                                        text="Doctor editable only"></p-message>
                                </h4>
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-4"
                                        *ngFor="let formFieldOption of formInstanceField.formFieldMapping.formFieldOptions">
                                        <p-radioButton name="radioInput"
                                            value="{{formFieldOption.formFieldOptionValue}}"
                                            [(ngModel)]="selectedFieldValues[formInstanceField.formInstanceFieldId]"
                                            label="{{formFieldOption.formFieldOptionValue}}"></p-radioButton>
                                    </div>
                                </div>
                            </div>
                            <div *ngIf="formInstanceField.formFieldMapping.inputType === 'DATE'">
                                <h4 class="ui-g">{{formInstanceField.formFieldMapping.question}} <div
                                        class="isRequiredSymbol" *ngIf="formInstanceField.formFieldMapping.isRequired">*
                                    </div>
                                    <p-message class="doctorOnlyMsg"
                                        *ngIf="!formInstanceField.formFieldMapping.isServicemanEditable" severity="warn"
                                        text="Doctor editable only"></p-message>
                                </h4>
                                <p-calendar name="dateInput" [showIcon]="true" placeholder="Date"
                                    [(ngModel)]="selectedFieldValues[formInstanceField.formInstanceFieldId]">
                                </p-calendar>
                            </div>
                            <div *ngIf="formInstanceField.formFieldMapping.inputType === 'TIME'">
                                <h4 class="ui-g">{{formInstanceField.formFieldMapping.question}} <div
                                        class="isRequiredSymbol" *ngIf="formInstanceField.formFieldMapping.isRequired">*
                                    </div>
                                    <p-message class="doctorOnlyMsg"
                                        *ngIf="!formInstanceField.formFieldMapping.isServicemanEditable" severity="warn"
                                        text="Doctor editable only"></p-message>
                                </h4>
                                <p-calendar name="timeInput" showTime="true" timeOnly="true"
                                    [(ngModel)]="selectedFieldValues[formInstanceField.formInstanceFieldId]">
                                </p-calendar>
                            </div>

                            <div *ngIf="formInstanceField.formFieldMapping.inputType === 'FILE_UPLOAD' || formInstanceField.formFieldMapping.inputType === 'IMAGE_UPLOAD'">
                                <h4 class="ui-g">{{formInstanceField.formFieldMapping.question}} </h4>
                                <p-fileUpload name="myfile[]" url="./upload.php" multiple="multiple" ></p-fileUpload>
                            </div>
                        </div>


                    </div>

                </div>
                <br />
                <p-footer>
                    <div id="buttons" *ngIf="selectedFormInstance.formInstanceStatusEnum.toString() !== 'SUBMITTED'">
                        
                        <button type="button" pButton pRipple icon="pi pi-save" label="Save"
                            (click)="updateFormInstance()" class="ui-button-info" style="margin: 3px"></button>

                        <button type="button" pButton icon="ui-icon-keyboard-backspace" label="Back" (click)="clearDialog()" style="margin: 3px"></button>

                        <button type="button" pButton icon="ui-icon-delete-forever" label="Delete" class="ui-button-danger"style="margin: 3px"
                            (click)="confirmDelete()"></button>


                        <button type="button" pButton icon="pi pi-check" type="submit" label="Submit" class="ui-button-success" style="margin: 3px"></button>

                    </div>
                    <div *ngIf="selectedFormInstance.formInstanceStatusEnum.toString() === 'SUBMITTED'">

                        <button type="button" pButton icon="ui-icon-archive" label="Archive" class="ui-button-warning"
                            (click)="confirmArchive()"></button>
                    </div>
                </p-footer>

            </div>
        </form>

    </div>
</div>